proxmox:
  endpoint: "https://192.168.1.100:8006/api2/json"
  node_name: "pve"
  datastore: "local-zfs"
  debian_template_vmid: 9100

network:
  base_prefix: "192.168.1"
  cidr_suffix: 24
  gateway_v4: "192.168.1.1"
  homelab_dns:
    - "192.168.1.102"
  upstream_dns:
    - "192.168.1.1"
    - "1.1.1.1"
  domain: "internal.example.com"

login_user: "your_username"

vms:
  bastion-01:
    vmid: 101
    role: "bastion"
    cpu_cores: 2
    memory_mb: 2048

  dns-01:
    vmid: 102
    role: "dns"
    cpu_cores: 2
    memory_mb: 2048

  proxy-01:
    vmid: 103
    role: "proxy"
    cpu_cores: 2
    memory_mb: 2048

  app-01:
    vmid: 201
    role: "app"
    cpu_cores: 4
    memory_mb: 8192

services:
  - name: "bastion"
    target_vm: "bastion-01"
  - name: "dns"
    target_vm: "dns-01"
  - name: "proxy"
    target_vm: "proxy-01"
  - name: "app"
    target_vm: "app-01"
  - name: "agh"
    target_vm: "dns-01"
    proxy:
      enable: true
      scheme: "http"
      port: 3000
    homepage:
      display_name: "AdGuard Home"
      category: "Infrastructure"
      icon: "si-adguard"
  - name: "homepage"
    target_vm: "app-01"
    proxy:
      enable: true
      scheme: "http"
      port: 3000
      allow_cidrs:
        - "192.168.1.0/24"
  - name: "ntfy"
    target_vm: "app-01"
    upstream_base_url: "https://ntfy.sh"
    security:
      message_size_limit: "4K"
      message_delay_limit: "1h"
      visitor_request_limit_burst: 30
      visitor_request_limit_replenish: "10s"
      visitor_message_daily_limit: 200
      visitor_subscription_limit: 20
      visitor_subscriber_rate_limiting: true
    proxy:
      enable: true
      scheme: "http"
      port: 8079
      methods:
        - "GET"
        - "HEAD"
        - "OPTIONS"
      public_hostnames:
        - "ntfy.example.com"
    homepage:
      display_name: "ntfy"
      category: "Infrastructure"
      icon: "mdi-bell-badge-outline"
      href: "https://ntfy.example.com"
  - name: "ntfy-pub"
    target_vm: "app-01"
    proxy:
      enable: true
      scheme: "http"
      port: 8079
      methods:
        - "POST"
        - "PUT"
        - "OPTIONS"
      public_hostnames:
        - "ntfy-pub.example.com"
  - name: "personal-site"
    target_vm: "app-01"
    image: "ghcr.io/neodymium6/profile.neodymium6.net:latest"
    update_enable: true
    update_on_boot_sec: "2m"
    update_unit_active_sec: "15m"
    update_cleanup_enable: true
    update_cleanup_until: "168h"
    proxy:
      enable: true
      scheme: "http"
      backends:
        - port: 8080
        - port: 8081
      healthcheck:
        path: "/"
        interval: "1s"
        timeout: "500ms"
      retry:
        attempts: 2
        initial_interval: "100ms"
      public_hostnames:
        - "www.example.com"
    homepage:
      display_name: "Personal Site"
      category: "Web"
      icon: "mdi-web"
  - name: "traefik"
    target_vm: "proxy-01"
    proxy:
      enable: true
      service: "api@internal"
      auth:
        users:
          - "admin:$apr1$CHANGE_ME"
      allow_cidrs:
        - "192.168.1.0/24"
    homepage:
      display_name: "Traefik"
      category: "Infrastructure"
      path: "/dashboard/"
      icon: "si-traefikproxy"
  # Proxmox Web UI reverse proxy example
  # Accessible at: https://proxmox-proxy.internal.example.com/
  - name: "proxmox"
    target_vm: "pve"  # Not used for backend (kept for compatibility)
    proxy:
      enable: true
      scheme: "https"
      port: 8006
      # Backend host: IP or FQDN of your Proxmox server
      backend_host: "192.168.1.100"
      # Required for self-signed TLS certificates on Proxmox
      insecure_skip_verify: true
      # Restrict access to local network only (recommended)
      allow_cidrs:
        - "192.168.1.0/24"
    homepage:
      display_name: "Proxmox VE"
      category: "Infrastructure"
      icon: "si-proxmox"
  - name: "prometheus"
    target_vm: "app-01"
    proxy:
      enable: true
      scheme: "http"
      port: 9090
      allow_cidrs:
        - "192.168.1.0/24"
    homepage:
      display_name: "Prometheus"
      category: "Monitoring"
      icon: "si-prometheus"
  - name: "alertmanager"
    target_vm: "app-01"
    notifications:
      ntfy_topic: "alerts"
      ntfy_base_url: "https://ntfy-pub-proxy.internal.example.com"
    proxy:
      enable: true
      scheme: "http"
      port: 9093
      allow_cidrs:
        - "192.168.1.0/24"
    homepage:
      display_name: "Alertmanager"
      category: "Monitoring"
      icon: "si-prometheus"
  - name: "grafana"
    target_vm: "app-01"
    proxy:
      enable: true
      scheme: "http"
      port: 3001
      allow_cidrs:
        - "192.168.1.0/24"
    homepage:
      display_name: "Grafana"
      category: "Monitoring"
      icon: "si-grafana"

proxy:
  acme_email: "you@example.net"
  cloudflare_dns_api_token: "CF_TOKEN_HERE"
  cloudflare_tunnel_token: "CF_TUNNEL_TOKEN_HERE"

docker:
  reserved_cidr: "172.30.0.0/16"
  networks:
    monitoring:
      subnet: "172.30.10.0/28"

secrets:
  monitoring:
    grafana_admin_user: "admin"
    grafana_admin_password: "changeme"
  ntfy:
    auth_users:
      - "subscriber:$2a$10$REPLACE_WITH_BCRYPT_HASH:user"
      - "publisher:$2a$10$REPLACE_WITH_BCRYPT_HASH:user"
    auth_access:
      - "subscriber:*:read"
      - "publisher:*:write"
  alertmanager:
    ntfy_user: "alerting"
    ntfy_password: "change_me"
    # ntfy_token: "tk_..."
